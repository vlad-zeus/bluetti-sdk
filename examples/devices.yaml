version: 1

# Named sinks â€” each device writes to its assigned sink (fallback: memory).
sinks:
  main_memory:
    type: memory
    maxlen: 200
  device_log:
    type: jsonl
    path: /var/log/power_sdk/devices.jsonl
  # combined fans out to both sinks simultaneously
  combined:
    type: composite
    sinks:
      - main_memory
      - device_log

defaults:
  vendor: bluetti
  protocol: v2
  poll_interval: 30
  sink: main_memory
  transport:
    key: mqtt
    opts:
      broker: "${MQTT_BROKER:-iot.bluettipower.com}"
      port: 18760
      keepalive: 60

devices:
  - id: living_room_battery
    profile_id: EL100V2
    transport:
      opts:
        device_sn: "${LIVING_ROOM_SN}"
        cert_password: "${LIVING_ROOM_CERT_PASSWORD}"
    options:
      device_address: 1

  - id: garage_battery
    profile_id: EL100V2
    poll_interval: 60
    transport:
      opts:
        device_sn: "${GARAGE_SN}"
        cert_password: "${GARAGE_CERT_PASSWORD}"
    options:
      device_address: 1

  - id: outdoor_station
    profile_id: EL30V2
    transport:
      opts:
        device_sn: "${OUTDOOR_SN}"
        cert_password: "${OUTDOOR_CERT_PASSWORD}"
    options:
      device_address: 1
